# Домашнее задание №7. Декомпозиция микросервисов

Предложить вариант разбиения приложения на микросервисы

## Описание проекта

Система управления проектами предназначена для помощи пользователям в организации и управлении проектами и задачами. 
Пользователи могут регистрироваться, создавать и редактировать проекты, добавлять задачи и комментарии к ним, 
а также получать уведомления о статусе проектов и задач. Архитектура системы основана на микросервисах, 
каждый из которых отвечает за отдельную функциональную область. Взаимодействие между сервисами осуществляется через API, 
а данные хранятся в отдельных базах данных для каждого сервиса.

Основные функциональные возможности системы включают:
- Регистрация и авторизация пользователей
- Управление профилем пользователя
- Создание, редактирование и удаление проектов
- Создание, редактирование и удаление задач в рамках проектов
- Добавление комментариев к задачам
- Получение уведомлений о статусе проектов, задач и комментариев

Система спроектирована с учетом принципов микросервисной архитектуры для обеспечения масштабируемости и независимого развёртывания компонентов.
---

## Пользовательские сценарии

Пользователь имеет возможность:
- зарегистрироваться в веб-сервисе
- авторизоваться в веб-сервисе
- разлогиниться в веб-сервисе
- просматривать и редактировать свой профиль
- создавать проекты
- редактировать проекты
- удалять проекты
- создавать задачи в рамках проектов
- редактировать задачи
- удалять задачи
- добавлять комментарии к задачам
- получать уведомления о проектах, задачах и комментариях

## Предметные области

- Пользователь
- Профиль
- Проект
- Задача
- Комментарий
- Уведомление

## Системные действия

- Регистрация
- Авторизация
- Создание проекта
- Редактирование проекта
- Удаление проекта
- Создание задачи
- Редактирование задачи
- Удаление задачи
- Добавление комментария
- Получение уведомлений

## Сервисы

- Сервис Авторизации
- Сервис Управления Профилем
- Сервис Проектов
- Сервис Задач
- Сервис Комментариев
- Сервис Уведомлений

---

### Сервис Авторизации

**Описание**

Сервис предоставляет API для авторизации пользователя: регистрация, логин, логаут.
При первичной регистрации обращается в Сервис Управления Профилем для создания профиля пользователя.
Сервис выдает и сохраняет в Redis токен авторизации jwt, подписанный приватным ключом,
а также предоставляет доступ к публичному ключу для валидации jwt в Istio.
Сервис предоставляет методы обработки запросов для Envoy фильтра Istio,
в частности валидирует jwt на наличие в базе данных активных токенов (в случае компрометации jwt может быть удален из БД и не пройдет валидацию).

**Запросы**

- `GET /api/v1/.well-known/jwks.json` — публичный ключ для валидации jwt

**Команды**

- `POST /api/v1/register` — регистрация нового пользователя
- `POST /api/v1/login` — логин
- `POST /api/v1/logout` — логаут
- `POST/GET/PATCH /api/v1/auth/istio/**` - фильтр запросов для Envoy фильтра Istio, валидация токена.

**События очередей**

- Отсутствует

**Пробы**

- `GET /api/v1/health` — возвращает состояние сервиса

**Зависимости**

- Сервис Управления Профилем: вызов метода создания профиля клиента `POST /api/v1/profiles`
- БД Redis для хранения jwt
- БД Postgres для хранения логин/пароля пользователя

---

### Сервис Управления Профилем

**Описание**

Сервис предоставляет возможность создавать и редактировать профиль пользователя.

**Запросы**

- `GET /api/v1/profiles/{id}` — запрос профиля пользователя

**Команды**

- `POST /api/v1/profiles` — создание нового профиля
- `PATCH /api/v1/profiles/{id}` — редактирование профиля

**События очередей**

Сервис генерирует события:
- `ProfileCreated` — событие при успешном создании профиля

**Пробы**

- `GET /api/v1/health` — возвращает состояние сервиса

**Зависимости**

- БД Postgres для хранения данных профиля пользователя

---

### Сервис Проектов

**Описание**

Сервис предоставляет API для работы с проектами. Пользователи могут создавать, редактировать и удалять проекты.

**Запросы**

- `GET /api/v1/projects` — отображает все проекты пользователя
- `GET /api/v1/projects/{id}` — отображает детальную информацию по проекту

**Команды**

- `POST /api/v1/projects` — создание нового проекта
- `PATCH /api/v1/projects/{id}` — редактирование проекта
- `DELETE /api/v1/projects/{id}` — удаление проекта

**События очередей**

Сервис генерирует события:
- `ProjectCreated` — событие при создании проекта
- `ProjectUpdated` — событие при обновлении проекта
- `ProjectDeleted` — событие при удалении проекта

**Пробы**

- `GET /api/v1/projects/health` — возвращает состояние сервиса

**Зависимости**

- БД Postgres для хранения данных проектов

---

### Сервис Задач

**Описание**

Сервис предоставляет API для работы с задачами в рамках проектов. Пользователи могут создавать, редактировать и удалять задачи.

**Запросы**

- `GET /api/v1/projects/{projectId}/tasks` — отображает все задачи в проекте
- `GET /api/v1/projects/{projectId}/tasks/{id}` — отображает детальную информацию по задаче

**Команды**

- `POST /api/v1/projects/{projectId}/tasks` — создание новой задачи
- `PATCH /api/v1/projects/{projectId}/tasks/{id}` — редактирование задачи
- `DELETE /api/v1/projects/{projectId}/tasks/{id}` — удаление задачи

**События очередей**

Сервис генерирует события:
- `TaskCreated` — событие при создании задачи
- `TaskUpdated` — событие при обновлении задачи
- `TaskDeleted` — событие при удалении задачи

**Пробы**

- `GET /api/v1/tasks/health` — возвращает состояние сервиса

**Зависимости**

- Сервис Проектов: вызов метода для получения информации о проекте `GET /api/v1/projects/{id}`
- БД Postgres для хранения данных задач

---

### Сервис Комментариев

**Описание**

Сервис предоставляет API для работы с комментариями к задачам. Пользователи могут добавлять, редактировать и удалять комментарии.

**Запросы**

- `GET /api/v1/tasks/{taskId}/comments` — отображает все комментарии к задаче
- `GET /api/v1/tasks/{taskId}/comments/{id}` — отображает детальную информацию по комментарию

**Команды**

- `POST /api/v1/tasks/{taskId}/comments` — добавление нового комментария
- `PATCH /api/v1/tasks/{taskId}/comments/{id}` — редактирование комментария
- `DELETE /api/v1/tasks/{taskId}/comments/{id}` — удаление комментария

**События очередей**

Сервис генерирует события:
- `CommentAdded` — событие при добавлении комментария
- `CommentUpdated` — событие при обновлении комментария
- `CommentDeleted` — событие при удалении комментария

**Пробы**

- `GET /api/v1/comments/health` — возвращает состояние сервиса

**Зависимости**

- Сервис Задач: вызов метода для получения информации о задаче `GET /api/v1/projects/{projectId}/tasks/{id}`
- БД Postgres для хранения данных комментариев

---

### Сервис Уведомлений

**Описание**

Сервис предоставляет API для работы с уведомлениями.

**Запросы**

- `GET /api/v1/notifications` — отображает все уведомления пользователя

**Команды**

- None

**События очередей**

Сервис подписан на события:
- `ProjectCreated` — проект создан
- `ProjectUpdated` — проект обновлен
- `ProjectDeleted` — проект удален
- `TaskCreated` — задача создана
- `TaskUpdated` — задача обновлена
- `TaskDeleted` — задача удалена
- `CommentAdded` — комментарий добавлен
- `CommentUpdated` — комментарий обновлен
- `CommentDeleted` — комментарий удален

**Пробы**

- `GET /api/v1/notifications/health` — возвращает состояние сервиса

**Зависимости**

- БД Postgres для хранения уведомлений
